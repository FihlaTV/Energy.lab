!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.NRJ={})}(this,function(e){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),o=1;o<arguments.length;o++){var i=arguments[o];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t});var c={dBodyAddForce:Module.cwrap("dBodyAddForce","",["number","number","number","number"]),dBodyAddRelForce:Module.cwrap("dBodyAddRelForce","",["number","number","number","number"]),dBodyAddRelTorque:Module.cwrap("dBodyAddRelTorque","",["number","number","number","number"]),dBodyAddTorque:Module.cwrap("dBodyAddTorque","",["number","number","number","number"]),dBodyCreate:Module.cwrap("dBodyCreate","number",["number"]),dBodyDestroy:Module.cwrap("dBodyDestroy","",["number"]),dBodyDisable:Module.cwrap("dBodyDisable","",["number"]),dBodyEnable:Module.cwrap("dBodyEnable","",["number"]),dBodyGetAngularVel:Module.cwrap("dBodyGetAngularVel","number",["number"]),dBodyGetForce:Module.cwrap("dBodyGetForce","number",["number"]),dBodyGetLinearVel:Module.cwrap("dBodyGetLinearVel","number",["number"]),dBodyGetPosition:Module.cwrap("dBodyGetPosition","number",["number"]),dBodyGetQuaternion:Module.cwrap("dBodyGetQuaternion","number",["number"]),dBodyGetTorque:Module.cwrap("dBodyGetTorque","number",["number"]),dBodyIsEnabled:Module.cwrap("dBodyIsEnabled","number",["number"]),dBodySetAngularVel:Module.cwrap("dBodySetAngularVel","",["number","number","number","number"]),dBodySetAutoDisableAngularThreshold:Module.cwrap("dBodySetAutoDisableAngularThreshold","",["number","number"]),dBodySetAutoDisableAverageSamplesCount:Module.cwrap("dBodySetAutoDisableTime","",["number","number"]),dBodySetAutoDisableFlag:Module.cwrap("dBodySetAutoDisableFlag","",["number","number"]),dBodySetAutoDisableLinearThreshold:Module.cwrap("dBodySetAutoDisableLinearThreshold","",["number","number"]),dBodySetAutoDisableTime:Module.cwrap("dBodySetAutoDisableTime","",["number","number"]),dBodySetFiniteRotationMode:Module.cwrap("dBodySetFiniteRotationMode","",["number","number"]),dBodySetGyroscopicMode:Module.cwrap("dBodySetGyroscopicMode","",["number","number"]),dBodySetForce:Module.cwrap("dBodySetForce","",["number","number","number","number"]),dBodySetLinearVel:Module.cwrap("dBodySetLinearVel","",["number","number","number","number"]),dBodySetMass:Module.cwrap("dBodySetMass","",["number","number"]),dBodyGetMass:Module.cwrap("dBodyGetMass","",["number","number"]),dBodySetPosition:Module.cwrap("dBodySetPosition","",["number","number","number","number"]),dBodySetQuaternion:Module.cwrap("dBodySetQuaternion","",["number","number"]),dBodySetRotation:Module.cwrap("dBodySetRotation","",["number","number"]),dBodySetTorque:Module.cwrap("dBodySetTorque","",["number","number","number","number"]),dBodyGetDxFlags:Module.cwrap("dBodyGetDxFlags","number",["number"]),dBodyGetFlags:Module.cwrap("dBodyGetFlags","number",["number"]),dBodySetFlags:Module.cwrap("dBodySetFlags","",["number","number"]),dBodySetNotification_interval:Module.cwrap("dBodySetNotification_interval","",["number","number"]),dCreateBox:Module.cwrap("dCreateBox","number",["number","number","number","number"]),dCreateCylinder:Module.cwrap("dCreateCylinder","number",["number","number"]),dCreateHeightfield:Module.cwrap("dCreateHeightfield","number",["number","number","number"]),dCreatePlane:Module.cwrap("dCreatePlane","number",["number","number","number","number","number"]),dCreateSphere:Module.cwrap("dCreateSphere","number",["number","number"]),dCreateTriMesh:Module.cwrap("dCreateTriMesh","number",["number","number","number","number","number"]),dCreateRay:Module.cwrap("dCreateRay","number",["number","number"]),dGeomRaySet:Module.cwrap("dGeomRaySet","",["number","number","number","number","number","number","number"]),dGeomDestroy:Module.cwrap("dGeomDestroy","",["number"]),dGeomGetMaterial:Module.cwrap("dGeomGetMaterial","number",["number"]),dGeomGetPosition:Module.cwrap("dGeomGetPosition","number",["number"]),dGeomGetQuaternion:Module.cwrap("dGeomGetQuaternion","",["number","number"]),dGeomHeightfieldDataBuildDouble:Module.cwrap("dGeomHeightfieldDataBuildDouble","",["number","number","number","number","number","number","number","number","number","number","number","number"]),dGeomHeightfieldDataCreate:Module.cwrap("dGeomHeightfieldDataCreate","number",[]),dGeomHeightfieldDataSetBounds:Module.cwrap("dGeomHeightfieldDataSetBounds","",["number","number","number"]),dGeomSetBody:Module.cwrap("dGeomSetBody","",["number","number"]),dGeomSetMaterial:Module.cwrap("dGeomSetMaterial","",["number","number"]),dGeomSetMotionVector:Module.cwrap("dGeomSetMotionVector","",["number","number"]),dGeomSetOffsetPosition:Module.cwrap("dGeomSetOffsetPosition","",["number","number","number"]),dGeomSetPosition:Module.cwrap("dGeomSetPosition","",["number","number","number","number"]),dGeomSetQuaternion:Module.cwrap("dGeomSetQuaternion","",["number","number"]),dGeomTriMeshDataBuildSingle:Module.cwrap("dGeomTriMeshDataBuildSingle","",[]),dGeomTriMeshDataCreate:Module.cwrap("dGeomTriMeshDataCreate","number",[]),getGeomsCollisionData:Module.cwrap("getGeomsCollisionData","number",[]),getGeomsCollisionBody:Module.cwrap("getGeomsCollisionBody","number",[]),getGeomsCollisionDataLength:Module.cwrap("getGeomsCollisionDataLength","number",[]),dInitODE2:Module.cwrap("dInitODE2","",["number"]),dInitODE:Module.cwrap("dInitODE","",[]),dJointAttach:Module.cwrap("dJointAttach","",["number","number","number"]),dJointCreateBall:Module.cwrap("dJointCreateBall","number",["number","number"]),dJointCreateHinge2:Module.cwrap("dJointCreateHinge2","number",["number","number"]),dJointCreateHinge:Module.cwrap("dJointCreateHinge","number",["number","number"]),dJointCreateSlider:Module.cwrap("dJointCreateSlider","number",["number","number"]),dJointCreateTransmission:Module.cwrap("dJointCreateTransmission","",["number","number"]),dJointCreateAMotor:Module.cwrap("dJointCreateAMotor","",["number","number"]),dJointCreateLMotor:Module.cwrap("dJointCreateLMotor","",["number","number"]),dJointCreateUniversal:Module.cwrap("dJointCreateUniversal","",["number","number"]),dJointCreatePiston:Module.cwrap("dJointCreatePiston","",["number","number"]),dJointCreateFixed:Module.cwrap("dJointCreateFixed","",["number","number"]),dJointDestroy:Module.cwrap("dJointDestroy","",["number"]),dJointGetHinge2Anchor2:Module.cwrap("dJointGetHinge2Anchor2","",["number","number"]),dJointGetHinge2Anchor:Module.cwrap("dJointGetHinge2Anchor","",["number","number"]),dJointGetHinge2Angle1:Module.cwrap("dJointGetHinge2Angle1","",["number"]),dJointGetHinge2Axis1:Module.cwrap("dJointGetHinge2Axis1","",["number","number"]),dJointGetHinge2Axis2:Module.cwrap("dJointGetHinge2Axis2","",["number","number"]),dJointGetHingeAnchor2:Module.cwrap("dJointGetHingeAnchor2","",["number","number"]),dJointGetHingeAnchor:Module.cwrap("dJointGetHingeAnchor","",["number","number"]),dJointGetHingeAxis:Module.cwrap("dJointGetHingeAxis","",["number","number"]),dJointGetHingeAngle:Module.cwrap("dJointGetHingeAngle","number",["number"]),dJointGetHingeAngleRate:Module.cwrap("dJointGetHingeAngleRate","number",["number"]),dJointGroupCreate:Module.cwrap("dJointGroupCreate","number",["number"]),dJointGroupDestroy:Module.cwrap("dJointGroupDestroy","",["number"]),dJointGroupEmpty:Module.cwrap("dJointGroupEmpty","",["number"]),dJointSetBallAnchor:Module.cwrap("dJointSetBallAnchor","",["number","number","number","number"]),dJointSetBallAnchor2:Module.cwrap("dJointSetBallAnchor2","",["number","number","number","number"]),dJointSetBallParam:Module.cwrap("dJointSetBallParam","",["number","number","number"]),dJointGetBallAnchor:Module.cwrap("dJointGetBallAnchor","",["number","number"]),dJointGetBallAnchor2:Module.cwrap("dJointGetBallAnchor2","",["number","number"]),dJointSetFeedback:Module.cwrap("dJointSetFeedback","",["number","number"]),dJointSetHinge2Anchor:Module.cwrap("dJointSetHinge2Anchor","",["number","number","number","number"]),dJointSetHinge2Axis1:Module.cwrap("dJointSetHinge2Axis1","",["number","number","number","number"]),dJointSetHinge2Axis2:Module.cwrap("dJointSetHinge2Axis2","",["number","number","number","number"]),dJointSetHinge2Param:Module.cwrap("dJointSetHinge2Param","",["number","number","number"]),dJointSetHingeAnchor:Module.cwrap("dJointSetHingeAnchor","",["number","number","number","number"]),dJointSetHingeAxis:Module.cwrap("dJointSetHingeAxis","",["number","number","number","number"]),dJointSetHingeParam:Module.cwrap("dJointSetHingeParam","",["number","number","number"]),dJointSetSliderAxis:Module.cwrap("dJointSetSliderAxis","",["number","number","number","number"]),dJointSetSliderParam:Module.cwrap("dJointSetSliderParam","",["number","number","number"]),dJointSetTransmissionAnchor1:Module.cwrap("dJointSetTransmissionAnchor1","",["number","number","number","number"]),dJointSetTransmissionAnchor2:Module.cwrap("dJointSetTransmissionAnchor2","",["number","number","number","number"]),dJointSetTransmissionAxis1:Module.cwrap("dJointSetTransmissionAxis1","",["number","number","number","number"]),dJointSetTransmissionAxis2:Module.cwrap("dJointSetTransmissionAxis2","",["number","number","number","number"]),dJointSetTransmissionAxis:Module.cwrap("dJointSetTransmissionAxis","",["number","number","number","number"]),dJointSetTransmissionBacklash:Module.cwrap("dJointSetTransmissionBacklash","",["number","number"]),dJointSetTransmissionMode:Module.cwrap("dJointSetTransmissionMode","",["number","number"]),dJointSetTransmissionRatio:Module.cwrap("dJointSetTransmissionRatio","",["number","number"]),dMassAdjust:Module.cwrap("dMassAdjust","",["number","number"]),dMassSetBox:Module.cwrap("dMassSetBox","",["number","number","number","number"]),dMassSetCylinder:Module.cwrap("dMassSetCylinder","",["number","number","number","number","number"]),dMassSetSphere:Module.cwrap("dMassSetSphere","",["number","number","number"]),dMassSetTrimesh:Module.cwrap("dMassSetTrimesh","",["number","number","number"]),dMassTranslate:Module.cwrap("dMassTranslate","",["number","number","number"]),dMaterialCreate:Module.cwrap("dMaterialCreate","number",["number"]),dMaterialGetParameter:Module.cwrap("dMaterialGetParameter","number",["number","number"]),dMaterialSetParameter:Module.cwrap("dMaterialSetParameter","",["number","number","number"]),dRFromAxisAndAngle:Module.cwrap("dRFromAxisAndAngle","",["number","number","number","number","number"]),dRFromZAxis:Module.cwrap("dRFromZAxis","",["number","number","number","number"]),dRSetIdentity:Module.cwrap("dRSetIdentity","",["number"]),dAreConnected:Module.cwrap("dAreConnected","number",["number","number"]),dAreConnectedExcluding:Module.cwrap("dAreConnectedExcluding","number",["number","number","number"]),dSimpleSpaceCreate:Module.cwrap("dSimpleSpaceCreate","number",["number"]),dHashSpaceCreate:Module.cwrap("dHashSpaceCreate","number",["number"]),dHashSpaceSetLevels:Module.cwrap("dHashSpaceSetLevels","",["number","number","number"]),dSpaceDestroy:Module.cwrap("dSpaceDestroy","",["number"]),dSpaceCollide:Module.cwrap("dSpaceCollide","",["number","number","number"]),dWorldCreate:Module.cwrap("dWorldCreate","",["number"]),dWorldGetGravity2:Module.cwrap("dWorldGetGravity2","number",["number"]),dWorldDestroy:Module.cwrap("dWorldDestroy","",["number"]),dWorldGetQuickStepNumIterations:Module.cwrap("dWorldGetQuickStepNumIterations","number",["number"]),dWorldQuickStep:Module.cwrap("dWorldQuickStep","number",["number","number"]),dWorldSetGravity:Module.cwrap("dWorldSetGravity","",["number","number","number","number"]),dWorldSetQuickStepNumIterations:Module.cwrap("dWorldSetQuickStepNumIterations","",["number","number"]),dWorldStep:Module.cwrap("dWorldStep","number",["number","number"]),dWorldSetAutoDisableAverageSamplesCount:Module.cwrap("dWorldSetAutoDisableAverageSamplesCount","",["number","number"]),dWorldSetAutoDisableFlag:Module.cwrap("dWorldSetAutoDisableFlag","",["number","number"]),dWorldSetAutoDisableLinearThreshold:Module.cwrap("dWorldSetAutoDisableLinearThreshold","",["number","number"]),dWorldSetAutoDisableAngularThreshold:Module.cwrap("dWorldSetAutoDisableAngularThreshold","",["number","number"]),dWorldSetAutoDisableSteps:Module.cwrap("dWorldSetAutoDisableSteps","",["number","number"]),dWorldSetAutoDisableTime:Module.cwrap("dWorldSetAutoDisableTime","",["number","number"]),dWorldSetNotificationInterval:Module.cwrap("dWorldSetNotificationInterval","",["number","number"]),dWorldSetFlags:Module.cwrap("dWorldSetFlags","",["number","number"]),dWorldGetFlags:Module.cwrap("dWorldGetFlags","number",["number"]),dWorldGetDxFlags:Module.cwrap("dWorldGetDxFlags","number",["number"]),dWorldSetERP:Module.cwrap("dWorldSetERP","",["number","number"]),dWorldSetCFM:Module.cwrap("dWorldSetCFM","",["number","number"]),dWorldGetERP:Module.cwrap("dWorldGetERP","number",["number"]),dWorldGetCFM:Module.cwrap("dWorldGetCFM","number",["number"]),init:Module.cwrap("init","boolean",["number","number","number","number"]),setFlagmode:Module.cwrap("setFlagmode","",["number"]),setFlagmode2:Module.cwrap("setFlagmode2","",["number"]),setMaxContact:Module.cwrap("setMaxContact","",["number"]),setTimestep:Module.cwrap("setTimestep","",["number","number"]),run:Module.cwrap("run","",[]),closeEnergy:Module.cwrap("dCloseODE","",[])},h={Malloc_Float64Array:function(e,t){var o=e.length*e.BYTES_PER_ELEMENT;return void 0===t&&(t=_malloc(o)),new Uint8Array(Module.HEAPU8.buffer,t,o).set(new Uint8Array(e.buffer)),t},Malloc_Float32Array:function(e,t){var o=e.length*e.BYTES_PER_ELEMENT;return void 0===t&&(t=_malloc(o)),new Uint8Array(Module.HEAPU8.buffer,t,o).set(new Uint8Array(e.buffer)),t},Malloc_Int32:function(e,t){var o=e.length*e.BYTES_PER_ELEMENT;return void 0===t&&(t=_malloc(o)),new Uint8Array(Module.HEAPU8.buffer,t,o).set(new Uint8Array(e.buffer)),t},Malloc_Quaternion:function(e,t,o,i,n){var r=new Float64Array([e,t,o,i]),d=r.length*r.BYTES_PER_ELEMENT;return void 0===n&&(n=_malloc(d)),new Uint8Array(Module.HEAPU8.buffer,n,d).set(new Uint8Array(r.buffer)),n},Malloc_Vector3:function(e,t,o,i){var n=new Float64Array([e,t,o]),r=n.length*n.BYTES_PER_ELEMENT;return void 0===i&&(i=_malloc(r)),new Uint8Array(Module.HEAPU8.buffer,i,r).set(new Uint8Array(n.buffer)),i},Malloc_dMass_Struct:function(){var e=new Float64Array(17),t=e.length*e.BYTES_PER_ELEMENT,o=_malloc(t);return new Uint8Array(Module.HEAPU8.buffer,o,t).set(new Uint8Array(e.buffer)),o},Malloc_dMatrix3x3:function(){var e=new Float64Array(12),t=e.length*e.BYTES_PER_ELEMENT;return this.DMatrix3_ptr=_malloc(t),new Uint8Array(Module.HEAPU8.buffer,this.DMatrix3_ptr,t).set(new Uint8Array(e.buffer)),this.DMatrix3_ptr},Malloc_feedback_struct:function(){var e=new Float64Array(16),t=e.length*e.BYTES_PER_ELEMENT;return this.feedBack=_malloc(t),new Uint8Array(Module.HEAPU8.buffer,this.feedBack,t).set(new Uint8Array(e.buffer)),this.feedBack},Free_DMatrix3_Ptr:function(e){_free(e)},Free_dMass_Struc:function(){_free(this.Mass_ptr)},Free:function(e){_free(e)},Pointer_To_Vector3:function(e,t){var o=Module.getValue(e+0,"double"),i=Module.getValue(e+8,"double"),n=Module.getValue(e+16,"double");return t?new Array(o,n,i):new Array(o,i,n)},UpdateQuaternion:function(e,t,o,i,n){Module.setValue(e+0,t,"double"),Module.setValue(e+8,o,"double"),Module.setValue(e+16,i,"double"),Module.setValue(e+24,n,"double")},Pointer_To_Vector4:function(e,t){if(t)var o=Module.getValue(e+0,"double"),i=-Module.getValue(e+8,"double"),n=-Module.getValue(e+16,"double"),r=-Module.getValue(e+24,"double");else o=Module.getValue(e+0,"double"),i=Module.getValue(e+8,"double"),n=Module.getValue(e+16,"double"),r=Module.getValue(e+24,"double");return new Array(o,i,n,r)}},r={Instances:[],DefaultMaterial:null,add:function(e){var t=new o(e);return this.Instances.push(t),t},GetDefault:function(){return r.DefaultMaterial=this.add("defaultPhysicMaterial"),r.DefaultMaterial}};function o(e){this.name=e,this.dxMaterial=c.dMaterialCreate(0),r.Instances.push(this)}o.prototype={setMaterialParameter:function(e,t){c.dMaterialSetParameter(this.dxMaterial,e,t)},getMaterialParameter:function(e){return c.dMaterialGetParameter(this.dxMaterial,e)}};var i=0,n=1,d=2,s=3,a=4,u=5,l=6,m=7,b=8,p=9,y=10,x=11,S=12,M=13,f=261,g=258,J=0,A=1,B=2,t=1,G=2,w=4,_=8,P=16,T=32,F=64,C=128,H=256,D=512,v=1024,W=2048,E=4096,V=8192;function k(){this.isDisable=!1,this.dxBody=null,this.dxGeom=null,this.dxMaterial=null,this.density=0,this.dxMass=null,this.pointer_pos=h.Malloc_Vector3(),this.pointer_rot=h.Malloc_Quaternion(1,0,0,0),this.parametres={mu:t,mu2:G,bounce:w,bounce_vel:_,soft_erp:P,soft_cfm:T,rho:F,rho2:C,rhoN:H,motion1:D,motion2:v,motionN:W,slip1:E,slip2:V}}function R(e,t,o,i,n,r){k.call(this),this.dxWorld=t,this.density=o,this.dxSpace=e,this.lx=i,this.ly=n,this.lz=r,this.dxGeom=c.dCreateBox(this.dxSpace,this.lx,this.ly,this.lz),0!==this.density&&(this.makeBody(),this.setMassfromGeometry({type:"box",lx:this.lx,ly:this.ly,lz:this.lz}),this.geomSetBody(this.dxGeom)),this.makePointer(),this.dGeomSetMaterial()}function N(e,t,o,i){k.call(this),this.radius=i||1,this.dxWorld=t,this.density=o,this.dxSpace=e,this.dxGeom=c.dCreateSphere(this.dxSpace,this.radius),0!=this.density&&(this.makeBody(),this.setMassfromGeometry({type:"sphere",radius:this.radius}),this.geomSetBody(this.dxGeom)),this.makePointer(),this.dGeomSetMaterial()}function j(e,t,o,i,n,r){k.call(this),this.dxWorld=t,this.density=o,this.dxSpace=e,this.radius=i,this.length=n,this.direction=r||1,this.dxGeom=c.dCreateCylinder(this.dxSpace,this.radius,this.length),0!=this.density&&(this.makeBody(),this.setMassfromGeometry({type:"cylinder",direction:this.direction,radius:this.radius,length:this.length}),this.geomSetBody(this.dxGeom)),this.makePointer(),this.dGeomSetMaterial()}function O(e,t,o,i,n,r,d,s,a,u,l){k.call(this),this.dxWorld=t,this.density=0,this.dxSpace=e,this.scale=s,this.offset=a,this.thickness=u,this.bWrap=l,this.pHeightData=h.Malloc_Float64Array(o),this.dxHeightfieldData=c.dGeomHeightfieldDataCreate(),c.dGeomHeightfieldDataBuildDouble(this.dxHeightfieldData,this.pHeightData,0,i,n,r,d,this.scale,this.offset,this.thickness,this.bWrap),c.dGeomHeightfieldDataSetBounds(this.dxHeightfieldData,-1,s+1),this.dxGeom=c.dCreateHeightfield(this.dxSpace,this.dxHeightfieldData,1),this.makePointer(),this.dGeomSetMaterial()}function L(e,t,o,i,n){k.call(this),this.dxWorld=t,this.dxSpace=e,this.density=n,this.verticesPointer=h.Malloc_Float32Array(o),this.indicesPointer=h.Malloc_Int32(i),this.dxTriMeshData=c.dGeomTriMeshDataCreate(),c.dGeomTriMeshDataBuildSingle(this.dxTriMeshData,this.verticesPointer,3*o.BYTES_PER_ELEMENT,o.length/3,this.indicesPointer,i.length,i.BYTES_PER_ELEMENT),this.dxGeom=c.dCreateTriMesh(this.dxSpace,this.dxTriMeshData,0,0,0),0!==this.density&&(this.makeBody(),this.setMassfromGeometry({type:"Trimesh"}),this.geomSetBody(this.dxGeom)),this.makePointer(),this.dGeomSetMaterial()}function Q(e,t,o,i,n){k.call(this),this.dxGeom=c.dCreatePlane(e,t,o,i,n),this.dGeomSetMaterial(r.GetDefault())}function I(e,t){this.dxWorld=e,this.dxJointGroup=t,this.dxJoint=null,this.parametres={LoStop:i,HiStop:n,Vel:d,LoVel:s,HiVel:a,FMax:u,FudgeFactor:l,Bounce:m,CFM:b,StopERP:p,StopCFM:y,SuspensionERP:x,SuspensionCFM:S,ERP:M,FMax2:f,Vel2:g,ParallelAxes:J,IntersectingAxes:A,ChainDrive:B}}function z(e,t){I.call(this,e,t),this.dxJoint=c.dJointCreateBall(this.dxWorld,this.dxJointGroup)}function U(e,t){I.call(this,e,t),this.dxJoint=c.dJointCreateFixed(this.dxWorld,this.dxJointGroup)}function q(e,t){I.call(this,e,t),this.dxJoint=c.dJointCreateHinge(this.dxWorld,this.dxJointGroup)}function Y(e,t){I.call(this,e,t),this.dxJoint=c.dJointCreateHinge2(this.dxWorld,this.dxJointGroup)}function Z(e,t,o){I.call(this,t,o),this.dxJoint=c.dJointCreateSlider(this.dxWorld,this.dxJointGroup)}function K(e,t){I.call(this,e,t),this.dxJoint=c.dJointCreateTransmission(this.dxWorld,this.dxJointGroup)}function X(e,t){I.call(this,e,t),this.dxJoint=c.dJointCreateUniversal(this.dxWorld,this.dxJointGroup)}function $(e,t){this.name=t.name||"car",this.wheels=[],this.carJoints=[];var o={w_radius:t.w_radius||.3,w_pos:t.w_pos||[1,-.45,1.1],w_density:t.w_density||10,w_friction:t.w_friction||500,soft_cfm:t.soft_cfm||.001,soft_erp:t.soft_erp||.5,size:t.size||[2.4,.5,1.4],pos:t.pos||[0,2.95,10],density:t.density||100,friction:t.friction||500,param:t.param||{LoStop:0,HiStop:0,FMax:50,Vel2:0,SuspensionERP:.18,SuspensionCFM:.004}},i=[[o.pos[0]-o.w_pos[0],o.pos[1]+o.w_pos[1],o.pos[2]+o.w_pos[2]],[o.pos[0]-o.w_pos[0],o.pos[1]+o.w_pos[1],o.pos[2]-o.w_pos[2]],[o.pos[0]+o.w_pos[0],o.pos[1]+o.w_pos[1],o.pos[2]+o.w_pos[2]],[o.pos[0]+o.w_pos[0],o.pos[1]+o.w_pos[1],o.pos[2]-o.w_pos[2]]];this.chassis=e.add({type:"box",name:this.name+"_body",size:o.size,pos:o.pos,density:o.density,friction:o.friction});for(var n=0;n<4;n++)this.wheels[n]=e.add({type:"sphere",name:this.name+"_w"+n,size:[o.w_radius],pos:i[n],density:o.w_density,friction:o.w_friction,soft_cfm:o.soft_cfm,soft_erp:o.soft_erp}),this.carJoints[n]=e.addJoint({type:"hinge2",b1:this.name+"_body",b2:this.name+"_w"+n,pos1:i[n],axe1:[0,1,0],axe2:[0,0,n%2==0?-1:1],param:o.param})}function ee(e){this.dxWorld=null,this.currentControl="",this.bodys=[],this.solids=[],this.joints=[],this.cars=[],this.tmpMatrix=[],this.tmpForce=[],this.byName={},this.isQuickStep=!0,this.jointID=0,this.default_stepSize=.033,this.timeStep=.033,this.gravity=[0,-9.81,0],this.contactFlag=null,this.contactFlag2=null,this.iteration=20,this.numStep=1,this.maxContact=7,this.dxJointGroup=0,this.flags={Mu2:1,AxisDep:1,FDir1:2,Bounce:4,SoftERP:8,SoftCFM:16,Motion1:32,Motion2:64,MotionN:128,Slip1:256,Slip2:512,Rolling:1024,Approx0:0,Approx1_1:4096,Approx1_2:8192,Approx1_N:16384,Approx1:28672},this.init(e)}k.prototype={constructor:k,setParam:function(e,t){if("string"==typeof e||e instanceof String)this.physicMaterial.setMaterialParameter(this.parametres[e],t);else for(var o in e)this.physicMaterial.setMaterialParameter(this.parametres[o],e[o])},getDxBodyPointersAndFlag:function(){c.dMassAdjust(this.dxMass,this.density),c.dBodySetMass(this.dxBody,this.dxMass),c.dGeomSetBody(this.dxGeom,this.dxBody),this.pointer_pos=c.dBodyGetPosition(this.dxBody),this.pointer_rot=c.dBodyGetQuaternion(this.dxBody),this.dxFlags=c.dBodyGetDxFlags(this.dxBody),h.Free_dMass_Struc()},dGeomSetMaterial:function(e){null!=this.dxGeom?(this.physicMaterial=new o,this.dxMaterial=this.physicMaterial.dxMaterial,c.dGeomSetMaterial(this.dxGeom,this.physicMaterial.dxMaterial)):console.log("assign material failed, dxGeom is null")},dBodySetPosition:function(e,t,o){c.dBodySetPosition(this.dxBody,e,t,o)},dBodySetQuaternion:function(e,t,o,i){var n=h.Malloc_Quaternion(e,t,o,i,this.pointer_rot);c.dBodySetQuaternion(this.dxBody,n)},dGeomSetPosition:function(e,t,o){c.dGeomSetPosition(this.dxGeom,e,t,o)},dGeomSetQuaternion:function(e,t,o,i){var n=h.Malloc_Quaternion(e,t,o,i,this.pointer_rot);c.dGeomSetQuaternion(this.dxGeom,n)},makePointer:function(){null!==this.dxBody?(this.pointer_pos=c.dBodyGetPosition(this.dxBody),this.pointer_rot=c.dBodyGetQuaternion(this.dxBody)):(this.pointer_pos=c.dGeomGetPosition(this.dxGeom),c.dGeomGetQuaternion(this.dxGeom,this.pointer_rot))},setTransform:function(e,t){null!==this.dxBody?(this.dBodySetPosition(e[0],e[2],e[1]),this.dBodySetQuaternion(t[3],-t[0],-t[2],-t[1])):(this.dGeomSetPosition(e[0],e[2],e[1]),this.dGeomSetQuaternion(t[3],-t[0],-t[2],-t[1]))},getTransform:function(){return[0,Module.HEAPF64[this.pointer_pos>>3],Module.HEAPF64[this.pointer_pos+16>>3],Module.HEAPF64[this.pointer_pos+8>>3],-Module.HEAPF64[this.pointer_rot+8>>3],-Module.HEAPF64[this.pointer_rot+24>>3],-Module.HEAPF64[this.pointer_rot+16>>3],Module.HEAPF64[this.pointer_rot>>3]]},setSoftERP:function(e){this.physicMaterial.setMaterialParameter(P,e)},setSoftCFM:function(e){this.physicMaterial.setMaterialParameter(T,e)},setBounce:function(e){this.physicMaterial.setMaterialParameter(w,e)},setBounce_vel:function(e){this.physicMaterial.setMaterialParameter(_,e)},setFriction:function(e){this.physicMaterial.setMaterialParameter(t,e)},dGeomGetPosition:function(){return[Module.HEAPF64[this.pointer_pos>>3],Module.HEAPF64[this.pointer_pos+16>>3],Module.HEAPF64[this.pointer_pos+8>>3]]},setQuaternion:function(e,t,o,i){h.Malloc_Quaternion(e,t,o,i,this.pointer_rot),null!=this.dxBody?c.dBodySetQuaternion(this.dxBody,this.pointer_rot):c.dGeomSetQuaternion(this.dxGeom,this.pointer_rot)},dBodySetLinearVel:function(e,t,o){c.dBodySetLinearVel(this.dxBody,e,t,o)},dBodySetAngularVel:function(e,t,o){c.dBodySetAngularVel(this.dxBody,e,t,o)},dBodyAddForce:function(e,t,o,i){i?c.dBodyAddRelForce(this.dxBody,e,t,o):c.dBodyAddForce(this.dxBody,e,t,o)},dBodyGetForce:function(){return h.Pointer_To_Vector3(c.dBodyGetForce(this.dxBody),!0)},dBodySetForce:function(e,t,o){c.dBodySetForce(this.dxBody,e,t,o)},dBodyAddTorque:function(e,t,o,i){i?c.dBodyAddRelTorque(this.dxBody,e,t,o):c.dBodyAddTorque(this.dxBody,e,t,o)},dBodySetTorque:function(e,t,o){c.dBodySetTorque(this.dxBody,e,t,o)},dBodyGetTorque:function(){return h.Pointer_To_Vector3(c.dBodyGetTorque(this.dxBody),!0)},dBodyGetLinearVel:function(){return h.Pointer_To_Vector3(c.dBodyGetLinearVel(this.dxBody),!0)},dBodyGetAngularVel:function(){return h.Pointer_To_Vector3(c.dBodyGetAngularVel(this.dxBody),!0)},enabled:function(){c.dBodyEnable(this.dxBody)},disable:function(){c.dBodyDisable(this.dxBody)},dBodyIsEnabled:function(){var e=4;return null!==this.dxBody&&(e=4&Module.HEAP32[c.dBodyGetDxFlags(this.dxBody)>>2]),e},dBodySetNotification_interval:function(e){c.dBodySetNotification_interval(this.dxBody,e)},destroyDynamicObject:function(){this.dxGeom&&(this.dGeomDestroy(),this.dxGeom=null),this.dxBody&&(this.dBodyDestroy(),this.dxBody=null)},dBodyGetFlags:function(){return c.dBodyGetFlags(this.dxBody)},dBodySetFlags:function(e){this.dxBody&&c.dBodySetFlags(this.dxBody,e)},dGeomDestroy:function(){c.dGeomDestroy(this.dxGeom)},dBodyDestroy:function(){c.dBodyDestroy(this.dxBody)},dispose:function(){this.destroyDynamicObject()},dBodyDisable:function(){c.dBodyDisable(this.dxBody)},dBodyEnable:function(){c.dBodyEnable(this.dxBody)},setZeroForce:function(){this.dBodyDisable(),this.dBodySetForce(0,0,0),this.dBodySetTorque(0,0,0),this.dBodySetLinearVel(0,0,0),this.dBodySetAngularVel(0,0,0),this.dBodyEnable()},makeBody:function(){null===this.dxBody&&(this.dxBody=c.dBodyCreate(this.dxWorld))},geomSetBody:function(e){c.dGeomSetBody(e,this.dxBody)},dBodyGetMass:function(){return Module.HEAPF64[this.dxMass>>3]},dBodySetMass:function(e){e&&(this.density=e),c.dMassAdjust(this.dxMass,this.density),c.dBodySetMass(this.dxBody,this.dxMass)},setMassfromGeometry:function(e){switch(null===this.dxMass&&(this.dxMass=h.Malloc_dMass_Struct()),e.type){case"box":c.dMassSetBox(this.dxMass,this.density,e.lx,e.ly,e.lz);break;case"sphere":c.dMassSetSphere(this.dxMass,this.density,e.radius);break;case"cylinder":c.dMassSetCylinder(this.dxMass,this.density,e.direction,e.radius,e.length);break;case"Trimesh":c.dMassSetTrimesh(this.dxMass,this.density,this.dxGeom)}this.dBodySetMass()},setMassCenter:function(e,t,o){this.dxMass&&c.dMassTranslate(this.dxMass,e,t,o)}},R.prototype=Object.assign(Object.create(k.prototype),{constructor:R}),N.prototype=Object.assign(Object.create(k.prototype),{constructor:N}),j.prototype=Object.assign(Object.create(k.prototype),{constructor:j}),O.prototype=Object.assign(Object.create(k.prototype),{constructor:O,setBounds:function(e,t){c.dGeomHeightfieldDataSetBounds(this.dxHeightfieldData,e-1,e+t+1)},setHeightData:function(e){h.Malloc_Float64Array(e,this.pHeightData)}}),L.prototype=Object.assign(Object.create(k.prototype),{constructor:L,setData:function(e,t){h.Malloc_Float32Array(e,this.verticesPointer),h.Malloc_Int32(t,this.indicesPointer)}}),Q.prototype=Object.assign(Object.create(k.prototype),{constructor:Q}),I.prototype={constructor:I,dJointAttach:function(e,t){c.dJointAttach(this.dxJoint,e,t)},setParam:function(e,t){},setPos1:function(e){},setPos2:function(e){},setAxis:function(e){},setAxis1:function(e){},setAxis2:function(e){},feedback:function(e){c.dJointSetFeedback(this.dxJoint,e)},dJointSetFeedback:function(e,t){c.dJointSetFeedback(e,t)},dJointDestroy:function(){c.dJointDestroy(this.dxJoint)}},z.prototype=Object.assign(Object.create(I.prototype),{constructor:z,setParam:function(e,t){c.dJointSetBallParam(this.dxJoint,this.parametres[e],t)},setPos1:function(e){c.dJointSetBallAnchor(this.dxJoint,e[0],e[2],e[1])},setPos2:function(e){c.dJointSetBallAnchor2(this.dxJoint,e[0],e[2],e[1])},dJointSetBallAnchor:function(e,t,o){c.dJointSetBallAnchor(this.dxJoint,e,t,o)},dJointSetBallAnchor2:function(e,t,o){c.dJointSetBallAnchor2(this.dxJoint,e,t,o)},dJointGetBallAnchor:function(){return null==this.anchor&&(this.anchor=h.Malloc_new_Vector3()),c.dJointGetBallAnchor(this.dxJoint,this.anchor),h.Pointer_To_Vector3(this.anchor,!0)},dJointGetBallAnchor2:function(){return null==this.anchor2&&(this.anchor2=h.Malloc_new_Vector3()),c.dJointGetBallAnchor2(this.dxJoint,this.anchor2),h.Pointer_To_Vector3(this.anchor,!0)},dJointSetParam:function(e,t){c.dJointSetBallParam(this.dxJoint,e,t)}}),U.prototype=Object.assign(Object.create(I.prototype),{constructor:U,dJointSetParam:function(e,t){}}),q.prototype=Object.assign(Object.create(I.prototype),{constructor:q,setParam:function(e,t){c.dJointSetHingeParam(this.dxJoint,this.parametres[e],t)},setPos1:function(e){c.dJointSetHingeAnchor(this.dxJoint,e[0],e[2],e[1])},setAxis:function(e){c.dJointSetHingeAxis(this.dxJoint,e[0],e[2],e[1])},setAxis1:function(e){c.dJointSetHingeAxis(this.dxJoint,e[0],e[2],e[1])},dJointSetHingeAnchor:function(e,t,o){c.dJointSetHingeAnchor(this.dxJoint,e,t,o)},dJointSetHingeAxis:function(e,t,o){c.dJointSetHingeAxis(this.dxJoint,e,t,o)},dJointGetHingeAnchor:function(){return null==this.anchor&&(this.anchor=h.Malloc_new_Vector3()),c.dJointGetHingeAnchor(this.dxJoint,this.anchor),h.Pointer_To_Vector3(this.anchor,!0)},dJointGetHingeAnchor2:function(){return null==this.anchor2&&(this.anchor2=h.Malloc_new_Vector3()),c.dJointGetHingeAnchor2(this.dxJoint,this.anchor2),h.Pointer_To_Vector3(this.anchor2,!0)},dJointGetHingeAxis:function(){return null==this.axis&&(this.axis=h.Malloc_new_Vector3()),c.dJointGetHingeAxis(this.dxJoint,this.axis),h.Pointer_To_Vector3(this.axis,!0)},dJointGetHingeAngle:function(){return console.log("test"),c.dJointGetHingeAngle(this.dxJoint)},dJointGetHingeAngleRate:function(){return c.dJointGetHingeAngleRate(this.dxJoint)},dJointSetParam:function(e,t){c.dJointSetHingeParam(this.dxJoint,e,t)}}),Y.prototype=Object.assign(Object.create(I.prototype),{constructor:Y,setParam:function(e,t){c.dJointSetHinge2Param(this.dxJoint,this.parametres[e],t)},setPos1:function(e){c.dJointSetHinge2Anchor(this.dxJoint,e[0],e[2],e[1])},setAxis1:function(e){c.dJointSetHinge2Axis1(this.dxJoint,e[0],e[2],e[1])},setAxis2:function(e){c.dJointSetHinge2Axis2(this.dxJoint,e[0],e[2],e[1])},dJointSetHinge2Anchor:function(e,t,o){c.dJointSetHinge2Anchor(this.dxJoint,e,t,o)},dJointSetHinge2Axis1:function(e,t,o){c.dJointSetHinge2Axis1(this.dxJoint,e,t,o)},dJointSetHinge2Axis2:function(e,t,o){c.dJointSetHinge2Axis2(this.dxJoint,e,t,o)},dJointGetHinge2Angle1:function(){return c.dJointGetHinge2Angle1(this.dxJoint)},dJointGetHinge2Anchor:function(){return null==this.anchor&&(this.anchor=h.Malloc_new_Vector3()),c.dJointGetHinge2Anchor(this.dxJoint,this.anchor),h.Pointer_To_Vector3(this.anchor,!0)},dJointGetHinge2Anchor2:function(){return null==this.anchor2&&(this.anchor2=h.Malloc_new_Vector3()),c.dJointGetHinge2Anchor2(this.dxJoint,this.anchor2),h.Pointer_To_Vector3(this.anchor2,!0)},dJointGetHinge2Axis1:function(){return null==this.axis1&&(this.axis1=h.Malloc_new_Vector3()),c.dJointGetHinge2Axis1(this.dxJoint,this.axis1),h.Pointer_To_Vector3(this.axis1,!0)},dJointGetHinge2Axis2:function(){return null==this.axis2&&(this.axis2=h.Malloc_new_Vector3()),c.dJointGetHinge2Axis2(this.dxJoint,this.axis2),h.Pointer_To_Vector3(this.axis2,!0)},dJointSetParam:function(e,t){c.dJointSetHinge2Param(this.dxJoint,e,t)}}),Z.prototype=Object.assign(Object.create(I.prototype),{constructor:Z,setParam:function(e,t){c.dJointSetSliderParam(this.dxJoint,this.parametres[e],t)},setAxis:function(e){c.dJointSetSliderAxis(this.dxJoint,e[0],e[2],e[1])},setAxis1:function(e){c.dJointSetSliderAxis(this.dxJoint,e[0],e[2],e[1])},dJointSetSliderAxis:function(e,t,o){c.dJointSetSliderAxis(this.dxJoint,e,t,o)},dJointSetParam:function(e,t){c.dJointSetSliderParam(this.dxJoint,e,t)}}),K.prototype=Object.assign(Object.create(I.prototype),{constructor:K,setParam:function(e,t){"backlash"===e?c.dJointSetTransmissionBacklash(this.dxJoint,t):"mode"===e?c.dJointSetTransmissionMode(this.dxJoint,t):"ratio"===e&&c.dJointSetTransmissionRatio(this.dxJoint,t)},setPos1:function(e){c.dJointSetTransmissionAnchor1(this.dxJoint,e[0],e[2],e[1])},setPos2:function(e){c.dJointSetTransmissionAnchor2(this.dxJoint,e[0],e[2],e[1])},setAxis:function(e){c.dJointSetTransmissionAxis(this.dxJoint,e[0],e[2],e[1])},setAxis1:function(e){c.dJointSetTransmissionAxis1(this.dxJoint,e[0],e[2],e[1])},setAxis2:function(e){c.dJointSetTransmissionAxis2(this.dxJoint,e[0],e[2],e[1])},dJointSetTransmissionMode:function(e){c.dJointSetTransmissionMode(this.dxJoint,e)},dJointSetTransmissionRatio:function(e){c.dJointSetTransmissionRatio(this.dxJoint,e)},dJointSetTransmissionAnchor1:function(e,t,o){c.dJointSetTransmissionAnchor1(this.dxJoint,e,t,o)},dJointSetTransmissionAnchor2:function(e,t,o){c.dJointSetTransmissionAnchor2(this.dxJoint,e,t,o)},dJointSetTransmissionAxis:function(e,t,o){c.dJointSetTransmissionAxis(this.dxJoint,e,t,o)},dJointSetTransmissionBacklash:function(e){c.dJointSetTransmissionBacklash(this.dxJoint,e)},dJointSetParam:function(e,t){}}),X.prototype=Object.assign(Object.create(I.prototype),{constructor:X}),$.prototype={constructor:$,swaybarControl:function(){for(var e,t=0;t<2;t++){var o=this.carJoints[t].getdjointHinge2Anchor();this.anchor1={x:o[0],x:o[1],z:o[2]};var i=this.carJoints[t].getdjointHinge2Anchor2();this.anchor2={x:i[0],y:i[1],z:i[2]};var n=this.carJoints[t].getdjointHinge2Axis1();this.axis1={x:n[0],y:n[1],z:n[2]};var r=this.anchor1.x-this.anchor2.x,d=this.anchor1.y-this.anchor2.y,s=this.anchor1.z-this.anchor2.z,a=r*this.axis1.x+d*this.axis1.y+s*this.axis1.z;if(0<a){e=500*a;var u={x:-n[0]*e,y:-n[1]*e,z:-n[2]*e};world.addForce({name:this.name+"_w"+t,f:u,useLocal:!1})}}},steeringControl:function(e){Math.PI;for(var t=Math.PI/6,o=0;o<4;o++)if(2<=o){var i=10*((e||0)*(1<o?-1:1)-this.carJoints[o].dJointGetHinge2Angle1());this.carJoints[o].setParam("HiStop",t),this.carJoints[o].setParam("LoStop",-t),this.carJoints[o].setParam("Vel",i)}else{i=10*(0-this.carJoints[o].dJointGetHinge2Angle1());this.carJoints[o].setParam("HiStop",.1),this.carJoints[o].setParam("LoStop",-.1),this.carJoints[o].setParam("Vel",i)}},engineControl:function(e){var t=e||0,o=15*Math.PI*t;if(0!=t)for(var i=0;i<4;++i)this.carJoints[i].setParam("Vel2",i%2==0?-o:o),this.carJoints[i].setParam("FMax2",50);else for(i=0;i<4;++i)this.carJoints[i].setParam("Vel2",0),this.carJoints[i].setParam("FMax2",20)}},ee.prototype={init:function(e){c.dInitODE2(0),this.dxWorld=c.dWorldCreate(),this.dxSpace=c.dSimpleSpaceCreate(0),this.contact=c.dJointGroupCreate(0),c.init(this.dxWorld,this.dxSpace,this.contact,this.contactFlag),this.set(e)},set:function(e){if(e=e||{},this.isQuickStep=void 0===e.quickStep||e.quickStep,this.iteration=void 0!==e.iteration?e.iteration:20,this.isQuickStep&&c.dWorldSetQuickStepNumIterations(this.dxWorld,this.iteration),this.timeStep=void 0!==e.timeStep?e.timeStep:.016,this.numStep=void 0!==e.numStep?e.numStep:1,this.setTimeStepAndNumStep(this.timeStep,this.numStep),this.maxContact=void 0!==e.maxContact?e.maxContact:6,c.setMaxContact(this.maxContact),this.gravity=void 0!==e.gravity?e.gravity:[0,-9.81,0],this.setGravity(this.gravity[0],this.gravity[1],this.gravity[2]),void 0!==e.flag){this.contactFlag=this.flags[e.flag[0]];for(var t=1;t<e.flag.length;t++)this.contactFlag|=this.flags[e.flag[t]]}else this.contactFlag=this.flags.Bounce;if(null!==this.contactFlag&&c.dWorldSetFlags(this.dxWorld,this.contactFlag),void 0!==e.flag2){this.contactFlag2=this.flags[e.flag2[0]];for(t=1;t<e.flag2.length;t++)this.contactFlag2|=this.flags[e.flag2[t]]}else this.contactFlag2=null;null!==this.contactFlag2&&c.setFlagmode2(this.contactFlag2),c.dWorldSetAutoDisableFlag(this.dxWorld,void 0!==e.autoDisable?e.autoDisable:0),void 0!==e.disableTime&&c.dWorldSetAutoDisableTime(this.dxWorld,void 0!==e.disableTime?e.disableTime:0),void 0!==e.disableSteps&&c.dWorldSetAutoDisableSteps(this.dxWorld,void 0!==e.disableSteps?e.disableSteps:10),c.dWorldSetAutoDisableLinearThreshold(this.dxWorld,void 0!==e.disableLinear?e.disableLinear:.01),c.dWorldSetAutoDisableAngularThreshold(this.dxWorld,void 0!==e.disableAngular?e.disableAngular:.01),void 0!==e.samplesCount&&c.dWorldSetAutoDisableAverageSamplesCount(this.dxWorld,e.samplesCount),void 0!==e.notificationInterval&&c.dWorldSetNotificationInterval(this.dxWorld,e.notificationInterval),void 0!==e.ERP&&c.dWorldSetERP(this.dxWorld,e.ERP),void 0!==e.CFM&&c.dWorldSetCFM(this.dxWorld,e.CFM),console.log("World Set")},step:function(){if(Module._run(),this.isQuickStep)for(var e=0;e<this.numStep;e++)Module._dWorldQuickStep(this.dxWorld,this.timeStep);else Module._dWorldStep(this.dxWorld,this.timeStep);Module._dJointGroupEmpty(this.contact)},dispose:function(){c.dWorldDestroy(this.dxWorld),this.reset()},reset:function(){for(c.dJointGroupDestroy(this.dxJointGroup);0<this.bodys.length;)this.bodys.pop().dispose();for(;0<this.solids.length;)this.solids.pop().dispose();this.bodys=[],this.solids=[],this.cars=[],this.joints=[],this.byName={},this.tmpMatrix=[],this.tmpForce=[]},takeControl:function(e){this.currentControl=e.name||""},stepVehicle:function(){var o=this.currentControl;this.cars.forEach(function(e,t){e.name===o&&(e.steeringControl(key[0]),e.engineControl(key[1]),e.chassis.dBodyEnable())})},addVehicle:function(e){this.cars.push(new $(this,e))},updateTerrain:function(e){this.byName[e.name].setHeightData(e.heightData)},add:function(e){var t=!1;e.density=null==e.density?0:e.density,e.kinematic&&(t=!0),e.size=null==e.size?[1,1,1]:e.size,e.pos=null==e.pos?[0,0,0]:e.pos,e.quat=null==e.quat?[0,0,0,1]:e.quat;var o=null;switch(e.type){case"box":o=new R(this.dxSpace,this.dxWorld,e.density,e.size[0],e.size[2],e.size[1]);break;case"sphere":o=new N(this.dxSpace,this.dxWorld,e.density,e.size[0]);break;case"cylinder":o=new j(this.dxSpace,this.dxWorld,e.density,e.size[0],e.size[1],1);break;case"plane":o=new Q(this.dxSpace,0,0,1,0);break;case"mesh":o=new L(this.dxSpace,this.dxWorld,e.vertices,e.indices,e.density);break;case"heightmap":case"terrain":o=new O(this.dxSpace,this.dxWorld,e.heightData,e.size[0],e.size[2],e.sample[0],e.sample[1],e.size[1],e.offset||0,e.thickness||10,e.bWrap||0)}return"plane"!==e.type&&o.setTransform(e.pos,e.quat),e.friction&&o.setFriction(e.friction),e.bounce&&o.setBounce(e.bounce),e.soft_cfm&&o.setSoftCFM(e.soft_cfm),e.soft_erp&&o.setSoftERP(e.soft_erp),e.bounce_vel&&o.setBounce_vel(e.bounce_vel),e.linearV&&o.dBodySetLinearVel(e.linearV[0],e.linearV[2],e.linearV[1]),e.angularV&&o.dBodySetAngularVel(e.angularV[0],e.angularV[2],e.angularV[1]),e.flag&&o.dBodySetFlags(e.flag),e.interval&&o.dBodySetNotification_interval(e.interval),e.disable&&o.disable(),e.name&&(this.byName[e.name]=o),0!==e.density||t?(this.bodys.push(o),0!==e.density&&h.Free(o.dxMass)):this.solids.push(o),o},addJoint:function(e){var t=null;switch(e.type=null==e.type?"hinge":e.type,e.pos1=null==e.pos1?[0,0,0]:e.pos1,e.pos2=null==e.pos2?[0,0,0]:e.pos2,e.axe1=null==e.axe1?[1,0,0]:e.axe1,e.axe2=null==e.axe2?[0,1,0]:e.axe2,e.type){case"ball":t=new z(this.dxWorld,this.dxJointGroup);break;case"hinge":t=new q(this.dxWorld,this.dxJointGroup);break;case"hinge2":t=new Y(this.dxWorld,this.dxJointGroup);break;case"fixed":t=new U(this.dxWorld,this.dxJointGroup);break;case"slider":t=new Z(this.dxWorld,this.dxJointGroup);break;case"transmission":t=new K(this.dxWorld,this.dxJointGroup);break;case"universal":t=new X(this.dxWorld,this.dxJointGroup)}if(this.byName[e.b1]&&this.byName[e.b2]&&null!==t){if(t.dJointAttach(this.byName[e.b1].dxBody,this.byName[e.b2].dxBody),e.pos1&&t.setPos1(e.pos1),e.pos2&&t.setPos2(e.pos2),e.axe&&t.setAxis(e.axe),e.axe1&&t.setAxis1(e.axe1),e.axe2&&t.setAxis2(e.axe2),e.param)for(var o in e.param)t.setParam(o,e.param[o]);return e.name&&(this.byName[e.name]=t),this.joints.push(t),t}throw new Error("body1 or/and body2 is null, joint need 2 valid mesh")},collide:function(e){c.dSpaceCollide(this.dxSpace,e.data,e.callback)},setMotionVector:function(e){var t=this.byName[e.name].dxGeom,o=this.byName[e.name].dGeomGetPosition(),i=[o[0]-e.v[0],o[1]-e.v[1],o[2]-e.v[2]],n=h.Malloc_Vector3(i[0],i[2],i[1]);this.byName[e.name].dGeomSetPosition(e.v[0],e.v[2],e.v[1]),c.dGeomSetMotionVector(t,n)},stepRigidBody:function(n,r){this.bodys.forEach(function(e,t){var o=r+8*t;n[o]=e.dBodyIsEnabled();var i=e.getTransform();n[o+1]=i[1],n[o+2]=i[2],n[o+3]=i[3],n[o+4]=i[4],n[o+5]=i[5],n[o+6]=i[6],n[o+7]=i[7]})},setTimeStepAndNumStep:function(e,t){this.timeStep=e||.016,this.numStep=t||1,c.setTimestep(this.timeStep,this.numStep)},setGravity:function(e,t,o){c.dWorldSetGravity(this.dxWorld,e,o,t)},setMaxContact:function(e){this.maxContact=e,c.setMaxContact(this.maxContact)},setERP:function(e){c.dWorldSetERP(this.dxWorld,e)},setCFM:function(e){c.dWorldGetCFM(this.dxWorld,e)},setAutoDisableFlag:function(e){c.dWorldSetAutoDisableFlag(this.dxWorld,e)},setAutoDisableAverageSamplesCount:function(e){c.dWorldSetAutoDisableAverageSamplesCount(this.dxWorld,e)},setAutoDisableLinearThreshold:function(e){c.dWorldSetAutoDisableLinearThreshold(this.dxWorld,e)},setAutoDisableAngularThreshold:function(e){c.dWorldSetAutoDisableAngularThreshold(this.dxWorld,e)},setAutoDisableSteps:function(e){c.dWorldSetAutoDisableSteps(this.dxWorld,e)},setAutoDisableTime:function(e){c.dWorldSetAutoDisableSteps(this.dxWorld,e)},setNotificationInterval:function(e){c.dWorldSetNotificationInterval(this.dxWorld,interval)},getMaxContact:function(){return this.maxContact},getERP:function(e){return c.dWorldGetERP(this.dxWorld)},getCFM:function(e){return c.dWorldGetCFM(this.dxWorld)},updateForce:function(){for(;0<this.tmpForce.length;)this.applyForce(this.tmpForce.pop())},applyForce:function(e){var t=this.byName[e[0]];if(void 0!==t)switch(e[1]||"force"){case"force":case 0:t.dBodyAddForce(e[2][0],e[2][2],e[2][1],!1);break;case"forceLocal":case 0:t.dBodyAddForce(e[2][0],e[2][2],e[2][1],!0);break;case"torque":case 0:t.dBodyAddTorque(e[2][0],e[2][2],e[2][1],!1);break;case"torqueLocal":case 0:t.dBodyAddTorque(e[2][0],e[2][2],e[2][1],!0)}},updateMatrix:function(){for(;0<this.tmpMatrix.length;)this.applyMatrix(this.tmpMatrix.pop())},applyMatrix:function(e){var t=this.byName[e[0]];void 0!==t&&(void 0===e[2]&&(e[2]=[0,0,0,1]),t.setTransform(e[1],e[2]))}},e.Energy=c,e.World=ee,e.DynamicObject=k,e.Joint=I,e.dynamicBox=R,e.dynamicSphere=N,e.dynamicCylinder=j,e.dynamicHeightmap=O,e.dynamicTriMesh=L,e.staticPlane=Q,e.dJointBall=z,e.dJointFixed=U,e.dJointHinge=q,e.dJointHinge2=Y,e.dJointSlider=Z,e.dJointTransmission=K,e.Vehicle=$,Object.defineProperty(e,"__esModule",{value:!0})});
